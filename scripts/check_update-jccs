#!/bin/bash

# CONFIG
JCCS_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )/.." && pwd )"
LOCAL_VERSION_FILE="$JCCS_DIR/VERSION"
CACHE_FILE="$HOME/.cache/jccs_last_check"
REMOTE_VERSION_URL="https://raw.githubusercontent.com/USER/JCCS/main/VERSION"

# check only once per day
if [[ -f "$CACHE_FILE" ]]; then
    last=$(cat "$CACHE_FILE")
    now=$(date +%s)
    if (( now - last < 86400 )); then
        return
    fi
fi

mkdir -p "$HOME/.cache"
date +%s > "$CACHE_FILE"

# get versions
local_ver=$(cat "$LOCAL_VERSION_FILE" 2>/dev/null)
remote_ver=$(curl -fsL "$REMOTE_VERSION_URL" 2>/dev/null)

if [[ -n "$remote_ver" && "$remote_ver" != "$local_ver" ]]; then
    echo -e "\033[0;33m[JCCS] Update available â†’ $remote_ver (current: $local_ver)\033[0m"
    echo "Run: jccs-update"
fi
